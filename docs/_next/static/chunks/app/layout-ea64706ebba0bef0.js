(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177,763],{763:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AuthButton:()=>M,LogoutButton:()=>F,authenticatedFetch:()=>$,checkAuthTokenValidity:()=>E,clearAllAuthData:()=>P,fetchUserInfo:()=>C,getAuthAccessToken:()=>x,getAuthError:()=>A,getAuthUserInfo:()=>S,getIsAuthenticated:()=>w,getIsLoading:()=>j,handleLogout:()=>T,initializeAuth:()=>v,redirectToLogin:()=>L,redirectToRegister:()=>B,setAuthAccessToken:()=>I,setAuthError:()=>N,setAuthIsAuthenticated:()=>_,setAuthLoading:()=>O,setAuthUserInfo:()=>k});var r=n(9585);let o=e=>{let t,n=new Set,r=(e,r)=>{let o="function"==typeof e?e(t):e;if(!Object.is(o,t)){let e=t;t=(null!=r?r:"object"!=typeof o||null===o)?o:Object.assign({},t,o),n.forEach(n=>n(t,e))}},o=()=>t,s={setState:r,getState:o,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e))},a=t=e(r,o,s);return s},s=e=>e?o(e):o,a=e=>e,l=e=>{let t=s(e),n=e=>(function(e,t=a){let n=r.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return r.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},i=e=>e?l(e):l;var u={exports:{}},c={},d=Symbol.for("react.transitional.element");function g(e,t,n){var r=null;if(void 0!==n&&(r=""+n),void 0!==t.key&&(r=""+t.key),"key"in t)for(var o in n={},t)"key"!==o&&(n[o]=t[o]);else n=t;return{$$typeof:d,type:e,key:r,ref:void 0!==(t=n.ref)?t:null,props:n}}c.Fragment=Symbol.for("react.fragment"),c.jsx=g,c.jsxs=g,u.exports=c;var f=u.exports;function h(e,t){let n;try{n=e()}catch{return}return{getItem:e=>{var t;let r=e=>null===e?null:JSON.parse(e,void 0),o=null!=(t=n.getItem(e))?t:null;return o instanceof Promise?o.then(r):r(o)},setItem:(e,t)=>n.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>n.removeItem(e)}}let m=e=>t=>{try{let n=e(t);return n instanceof Promise?n:{then:e=>m(e)(n),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>m(t)(e)}}};console.log("authStore.ts: Module loaded. typeof window:",typeof window);let b=e=>({accessToken:null,userInfo:null,isAuthenticated:!1,isLoading:!1,error:null,setAccessToken:t=>{e({accessToken:t,isAuthenticated:!!t})},setUserInfo:t=>{e({userInfo:t})},setIsAuthenticated:t=>{e({isAuthenticated:t})},setLoading:t=>{e({isLoading:t})},setError:t=>{e({error:t})},clearAuthData:()=>{e({accessToken:null,userInfo:null,isAuthenticated:!1,isLoading:!1,error:null})}}),p=i(b);if("u">typeof window){console.log("useAuthStore: Client-side persistent store initialization.");let e={getItem:e=>(console.log(`ClientStorage.getItem called for: ${e}`),sessionStorage.getItem(e)),setItem:(e,t)=>{console.log(`ClientStorage.setItem called for: ${e}`),sessionStorage.setItem(e,t)},removeItem:e=>{console.log(`ClientStorage.removeItem called for: ${e}`),sessionStorage.removeItem(e)}};p=i()(((e,t)=>(n,r,o)=>{let s,a={storage:h(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},l=!1,i=new Set,u=new Set,c=a.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),n(...e)},r,o);let d=()=>{let e=a.partialize({...r()});return c.setItem(a.name,{state:e,version:a.version})},g=o.setState;o.setState=(e,t)=>{g(e,t),d()};let f=e((...e)=>{n(...e),d()},r,o);o.getInitialState=()=>f;let b=()=>{var e,t;if(!c)return;l=!1,i.forEach(e=>{var t;return e(null!=(t=r())?t:f)});let o=(null==(t=a.onRehydrateStorage)?void 0:t.call(a,null!=(e=r())?e:f))||void 0;return m(c.getItem.bind(c))(a.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===a.version)return[!1,e.state];else{if(a.migrate){let t=a.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[o,l]=e;if(n(s=a.merge(l,null!=(t=r())?t:f),!0),o)return d()}).then(()=>{null==o||o(s,void 0),s=r(),l=!0,u.forEach(e=>e(s))}).catch(e=>{null==o||o(void 0,e)})};return o.persist={setOptions:e=>{a={...a,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>b(),hasHydrated:()=>l,onHydrate:e=>(i.add(e),()=>{i.delete(e)}),onFinishHydration:e=>(u.add(e),()=>{u.delete(e)})},a.skipHydration||b(),s||f})(b,{name:"auth-storage",storage:h(()=>e),partialize:e=>({userInfo:e.userInfo}),onRehydrateStorage:e=>(console.log("Zustand: Rehydrating storage",e),(e,t)=>{t&&console.error("Zustand: Failed to rehydrate",t)})}))}else console.log("useAuthStore: Server-side dummy store is active.");let y="http://localhost:8000",v=e=>{y=e,console.log(`Auth utilities initialized with API_BASE_URL: ${y}`)},x=()=>p.getState().accessToken,S=()=>p.getState().userInfo,w=()=>p.getState().isAuthenticated,j=()=>p.getState().isLoading,A=()=>p.getState().error,I=e=>{p.getState().setAccessToken(e)},k=e=>{p.getState().setUserInfo(e)},_=e=>{p.getState().setIsAuthenticated(e)},O=e=>{p.getState().setLoading(e)},N=e=>{p.getState().setError(e)},P=()=>{p.getState().clearAuthData()},E=async()=>{let e=x();if(!e)return!1;try{return!(1e3*JSON.parse(atob(e.split(".")[1])).exp<Date.now())||(console.warn("Access token expired. Attempting to refresh..."),!1)}catch(e){return console.error("Invalid access token format:",e),P(),!1}},L=()=>{let e=btoa(JSON.stringify({fe_base_url:window.location.origin,nonce:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}));window.location.href=`${y}/auth/login?state=${e}`},T=async()=>{O(!0),N(null);try{let e=await fetch(`${y}/auth/logout`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(console.log("handleLogout logout response:",e),e.ok)return P(),console.log("Successfully logged out via BE1."),window.location.href="/logout-success",!0;{let t=await e.text();return N(`로그아웃 실패: ${e.status} ${t}`),console.error("Logout failed on BE1:",e.status,t),!1}}catch(e){return N(`네트워크 오류: ${e instanceof Error?e.message:"알 수 없는 오류"}`),console.error("Network error during logout:",e),!1}finally{O(!1)}};async function $(e,t){let n=x(),r=new Headers(null==t?void 0:t.headers);n&&r.set("Authorization",`Bearer ${n}`);let o="string"==typeof e&&e.startsWith("/")?`${y}${e}`:e,s=await fetch(o,{...t,headers:r});if(401===s.status)throw console.warn("API request returned 401. Attempting token refresh..."),L(),Error("Authentication required: Token expired or invalid.");return s}let C=async()=>{O(!0),N(null);try{if(!x())return N("Access token is missing."),O(!1),null;let e=await $(`${y}/auth/me`,{method:"GET"});if(e.ok){let t=await e.json();return k(t),_(!0),t}{let t=await e.text();return N(`사용자 정보 가져오기 실패: ${e.status} ${t}`),P(),null}}catch(e){return N(`네트워크 오류 또는 사용자 정보 가져오기 실패: ${e instanceof Error?e.message:"알 수 없는 오류"}`),P(),null}finally{O(!1)}},B=()=>{let e=btoa(JSON.stringify({fe_base_url:window.location.origin,nonce:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}));window.location.href=`${y}/auth/register?state=${e}`},M=()=>{let{accessToken:e,userInfo:t,isAuthenticated:n,isLoading:o,error:s}=p();return(0,r.useEffect)(()=>{console.log("AuthButton: Component mounted or auth state changed."),!e||t||o?!e&&n&&(console.warn("AuthButton: Inconsistent auth state detected (no accessToken but isAuthenticated is true). Clearing auth data."),P()):C()},[e,t,n,o]),f.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 font-inter",children:f.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-xl border border-gray-200 w-full max-w-md",children:[f.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-6 text-center",children:"인증 관리"}),o&&f.jsx("p",{className:"text-blue-600 text-center mb-4",children:"로딩 중..."}),s&&f.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[f.jsx("strong",{className:"font-bold",children:"오류:"}),f.jsxs("span",{className:"block sm:inline",children:[" ",s]})]}),!o&&f.jsx(f.Fragment,{children:n?f.jsxs("div",{className:"text-center",children:[f.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"환영합니다!"}),f.jsx("p",{className:"text-xl font-semibold text-gray-900 mb-4",children:t?f.jsxs(f.Fragment,{children:[t.username&&f.jsxs("span",{children:["사용자 이름: ",t.username]}),t.email&&f.jsxs("span",{className:"block",children:["이메일: ",t.email]}),0===Object.keys(t).length&&f.jsx("span",{children:"사용자 정보 없음 (백엔드 확인 필요)"})]}):f.jsx("span",{children:"사용자 정보를 불러오는 중..."})}),f.jsx("button",{onClick:T,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75",children:"로그아웃"})]}):f.jsxs("div",{className:"text-center",children:[f.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"로그인이 필요합니다."}),f.jsx("button",{onClick:L,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75",children:"로그인"})]})})]})})},F=()=>{let e=async e=>{e.preventDefault(),console.log("LogoutButton (uicomp): Logout button clicked."),await T()};return f.jsx("li",{children:f.jsx("button",{onClick:e,className:"hover:underline bg-red-500 text-white px-3 py-1 rounded-md",children:"로그아웃"})})}},1400:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}},1974:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});var r=n(9605),o=n(9585),s=n(763);function a(e){let{children:t}=e;return(0,o.useEffect)(()=>{let e="https://gag.nonda.info";if(!e)return void console.error("Error: NEXT_PUBLIC_API_BASE_URL environment variable is not set.");(0,s.initializeAuth)(e)},[]),(0,r.jsx)(r.Fragment,{children:t})}},2345:()=>{},3778:(e,t,n)=>{"use strict";function r(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}}),n(6766)},3931:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,1400,23)),Promise.resolve().then(n.t.bind(n,2345,23)),Promise.resolve().then(n.bind(n,7041)),Promise.resolve().then(n.bind(n,1974))},4877:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i}});let r=n(9605),o=n(9585),s=n(3778);function a(e){return{default:e&&"default"in e?e.default:e}}n(8799);let l={loader:()=>Promise.resolve(a(()=>null)),loading:null,ssr:!0},i=function(e){let t={...l,...e},n=(0,o.lazy)(()=>t.loader().then(a)),i=t.loading;function u(e){let a=i?(0,r.jsx)(i,{isLoading:!0,pastDelay:!0,error:null}):null,l=!t.ssr||!!t.loading,u=l?o.Suspense:o.Fragment,c=t.ssr?(0,r.jsxs)(r.Fragment,{children:[null,(0,r.jsx)(n,{...e})]}):(0,r.jsx)(s.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(n,{...e})});return(0,r.jsx)(u,{...l?{fallback:a}:{},children:c})}return u.displayName="LoadableComponent",u}},6837:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let r=n(5247)._(n(4877));function o(e,t){var n;let o={};"function"==typeof e&&(o.loader=e);let s={...o,...t};return(0,r.default)({...s,modules:null==(n=s.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7041:(e,t,n)=>{"use strict";n.d(t,{AuthButton:()=>i,LogoutButton:()=>u});var r=n(9605),o=n(6837),s=n.n(o);let a=s()(()=>n.e(763).then(n.bind(n,763)).then(e=>e.AuthButton),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),l=s()(()=>n.e(763).then(n.bind(n,763)).then(e=>e.LogoutButton),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),i=()=>(0,r.jsx)(a,{}),u=()=>(0,r.jsx)(l,{})},7808:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return r.workAsyncStorageInstance}});let r=n(9318)},7928:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{bindSnapshot:function(){return a},createAsyncLocalStorage:function(){return s},createSnapshot:function(){return l}});let n=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class r{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}static bind(e){return e}}let o="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function s(){return o?new o:new r}function a(e){return o?o.bind(e):r.bind(e)}function l(){return o?o.snapshot():function(e,...t){return e(...t)}}},8799:(e,t,n)=>{"use strict";function r(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return r}}),n(9605),n(3220),n(7808),n(3437)},9318:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return r}});let r=(0,n(7928).createAsyncLocalStorage)()}},e=>{var t=t=>e(e.s=t);e.O(0,[322,390,110,358],()=>t(3931)),_N_E=e.O()}]);