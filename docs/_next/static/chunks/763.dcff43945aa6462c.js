"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[763],{763:(e,t,r)=>{r.r(t),r.d(t,{AuthButton:()=>U,LogoutButton:()=>D,authenticatedFetch:()=>_,checkAuthTokenValidity:()=>T,clearAllAuthData:()=>L,fetchUserInfo:()=>B,getAuthAccessToken:()=>v,getAuthError:()=>I,getAuthUserInfo:()=>S,getIsAuthenticated:()=>w,getIsLoading:()=>A,handleLogout:()=>O,initializeAuth:()=>y,redirectToLogin:()=>C,redirectToRegister:()=>z,setAuthAccessToken:()=>k,setAuthError:()=>E,setAuthIsAuthenticated:()=>N,setAuthLoading:()=>$,setAuthUserInfo:()=>j});var n=r(9585);let o=e=>{let t,r=new Set,n=(e,n)=>{let o="function"==typeof e?e(t):e;if(!Object.is(o,t)){let e=t;t=(null!=n?n:"object"!=typeof o||null===o)?o:Object.assign({},t,o),r.forEach(r=>r(t,e))}},o=()=>t,s={setState:n,getState:o,getInitialState:()=>a,subscribe:e=>(r.add(e),()=>r.delete(e))},a=t=e(n,o,s);return s},s=e=>e?o(e):o,a=e=>e,i=e=>{let t=s(e),r=e=>(function(e,t=a){let r=n.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return n.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},l=e=>e?i(e):i;var c={exports:{}},u={},d=Symbol.for("react.transitional.element");function g(e,t,r){var n=null;if(void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),"key"in t)for(var o in r={},t)"key"!==o&&(r[o]=t[o]);else r=t;return{$$typeof:d,type:e,key:n,ref:void 0!==(t=r.ref)?t:null,props:r}}u.Fragment=Symbol.for("react.fragment"),u.jsx=g,u.jsxs=g,c.exports=u;var h=c.exports;function m(e,t){let r;try{r=e()}catch{return}return{getItem:e=>{var t;let n=e=>null===e?null:JSON.parse(e,void 0),o=null!=(t=r.getItem(e))?t:null;return o instanceof Promise?o.then(n):n(o)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}let f=e=>t=>{try{let r=e(t);return r instanceof Promise?r:{then:e=>f(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>f(t)(e)}}};console.log("authStore.ts: Module loaded. typeof window:",typeof window);let p=e=>({accessToken:null,userInfo:null,isAuthenticated:!1,isLoading:!1,error:null,setAccessToken:t=>{e({accessToken:t,isAuthenticated:!!t})},setUserInfo:t=>{e({userInfo:t})},setIsAuthenticated:t=>{e({isAuthenticated:t})},setLoading:t=>{e({isLoading:t})},setError:t=>{e({error:t})},clearAuthData:()=>{e({accessToken:null,userInfo:null,isAuthenticated:!1,isLoading:!1,error:null})}}),b=l(p);if("u">typeof window){console.log("useAuthStore: Client-side persistent store initialization.");let e={getItem:e=>(console.log(`ClientStorage.getItem called for: ${e}`),sessionStorage.getItem(e)),setItem:(e,t)=>{console.log(`ClientStorage.setItem called for: ${e}`),sessionStorage.setItem(e,t)},removeItem:e=>{console.log(`ClientStorage.removeItem called for: ${e}`),sessionStorage.removeItem(e)}};b=l()(((e,t)=>(r,n,o)=>{let s,a={storage:m(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1,l=new Set,c=new Set,u=a.storage;if(!u)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),r(...e)},n,o);let d=()=>{let e=a.partialize({...n()});return u.setItem(a.name,{state:e,version:a.version})},g=o.setState;o.setState=(e,t)=>{g(e,t),d()};let h=e((...e)=>{r(...e),d()},n,o);o.getInitialState=()=>h;let p=()=>{var e,t;if(!u)return;i=!1,l.forEach(e=>{var t;return e(null!=(t=n())?t:h)});let o=(null==(t=a.onRehydrateStorage)?void 0:t.call(a,null!=(e=n())?e:h))||void 0;return f(u.getItem.bind(u))(a.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===a.version)return[!1,e.state];else{if(a.migrate){let t=a.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[o,i]=e;if(r(s=a.merge(i,null!=(t=n())?t:h),!0),o)return d()}).then(()=>{null==o||o(s,void 0),s=n(),i=!0,c.forEach(e=>e(s))}).catch(e=>{null==o||o(void 0,e)})};return o.persist={setOptions:e=>{a={...a,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>p(),hasHydrated:()=>i,onHydrate:e=>(l.add(e),()=>{l.delete(e)}),onFinishHydration:e=>(c.add(e),()=>{c.delete(e)})},a.skipHydration||p(),s||h})(p,{name:"auth-storage",storage:m(()=>e),partialize:e=>({userInfo:e.userInfo}),onRehydrateStorage:e=>(console.log("Zustand: Rehydrating storage",e),(e,t)=>{t&&console.error("Zustand: Failed to rehydrate",t)})}))}else console.log("useAuthStore: Server-side dummy store is active.");let x="http://localhost:8000",y=e=>{x=e,console.log(`Auth utilities initialized with API_BASE_URL: ${x}`)},v=()=>b.getState().accessToken,S=()=>b.getState().userInfo,w=()=>b.getState().isAuthenticated,A=()=>b.getState().isLoading,I=()=>b.getState().error,k=e=>{b.getState().setAccessToken(e)},j=e=>{b.getState().setUserInfo(e)},N=e=>{b.getState().setIsAuthenticated(e)},$=e=>{b.getState().setLoading(e)},E=e=>{b.getState().setError(e)},L=()=>{b.getState().clearAuthData()},T=async()=>{let e=v();if(!e)return!1;try{return!(1e3*JSON.parse(atob(e.split(".")[1])).exp<Date.now())||(console.warn("Access token expired. Attempting to refresh..."),!1)}catch(e){return console.error("Invalid access token format:",e),L(),!1}},C=()=>{let e=btoa(JSON.stringify({fe_base_url:window.location.origin,nonce:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}));window.location.href=`${x}/auth/login?state=${e}`},O=async()=>{$(!0),E(null);try{let e=await fetch(`${x}/auth/logout`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(console.log("handleLogout logout response:",e),e.ok)return L(),console.log("Successfully logged out via BE1."),window.location.href="/logout-success",!0;{let t=await e.text();return E(`로그아웃 실패: ${e.status} ${t}`),console.error("Logout failed on BE1:",e.status,t),!1}}catch(e){return E(`네트워크 오류: ${e instanceof Error?e.message:"알 수 없는 오류"}`),console.error("Network error during logout:",e),!1}finally{$(!1)}};async function _(e,t){let r=v(),n=new Headers(null==t?void 0:t.headers);r&&n.set("Authorization",`Bearer ${r}`);let o="string"==typeof e&&e.startsWith("/")?`${x}${e}`:e,s=await fetch(o,{...t,headers:n});if(401===s.status)throw console.warn("API request returned 401. Attempting token refresh..."),C(),Error("Authentication required: Token expired or invalid.");return s}let B=async()=>{$(!0),E(null);try{if(!v())return E("Access token is missing."),$(!1),null;let e=await _(`${x}/auth/me`,{method:"GET"});if(e.ok){let t=await e.json();return j(t),N(!0),t}{let t=await e.text();return E(`사용자 정보 가져오기 실패: ${e.status} ${t}`),L(),null}}catch(e){return E(`네트워크 오류 또는 사용자 정보 가져오기 실패: ${e instanceof Error?e.message:"알 수 없는 오류"}`),L(),null}finally{$(!1)}},z=()=>{let e=btoa(JSON.stringify({fe_base_url:window.location.origin,nonce:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}));window.location.href=`${x}/auth/register?state=${e}`},U=()=>{let{accessToken:e,userInfo:t,isAuthenticated:r,isLoading:o,error:s}=b();return(0,n.useEffect)(()=>{console.log("AuthButton: Component mounted or auth state changed."),!e||t||o?!e&&r&&(console.warn("AuthButton: Inconsistent auth state detected (no accessToken but isAuthenticated is true). Clearing auth data."),L()):B()},[e,t,r,o]),h.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 font-inter",children:h.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-xl border border-gray-200 w-full max-w-md",children:[h.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-6 text-center",children:"인증 관리"}),o&&h.jsx("p",{className:"text-blue-600 text-center mb-4",children:"로딩 중..."}),s&&h.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[h.jsx("strong",{className:"font-bold",children:"오류:"}),h.jsxs("span",{className:"block sm:inline",children:[" ",s]})]}),!o&&h.jsx(h.Fragment,{children:r?h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-lg text-gray-700 mb-2",children:"환영합니다!"}),h.jsx("p",{className:"text-xl font-semibold text-gray-900 mb-4",children:t?h.jsxs(h.Fragment,{children:[t.username&&h.jsxs("span",{children:["사용자 이름: ",t.username]}),t.email&&h.jsxs("span",{className:"block",children:["이메일: ",t.email]}),0===Object.keys(t).length&&h.jsx("span",{children:"사용자 정보 없음 (백엔드 확인 필요)"})]}):h.jsx("span",{children:"사용자 정보를 불러오는 중..."})}),h.jsx("button",{onClick:O,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75",children:"로그아웃"})]}):h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"로그인이 필요합니다."}),h.jsx("button",{onClick:C,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75",children:"로그인"})]})})]})})},D=()=>{let e=async e=>{e.preventDefault(),console.log("LogoutButton (uicomp): Logout button clicked."),await O()};return h.jsx("li",{children:h.jsx("button",{onClick:e,className:"hover:underline bg-red-500 text-white px-3 py-1 rounded-md",children:"로그아웃"})})}}}]);